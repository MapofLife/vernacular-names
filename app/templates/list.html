{% extends "templates/base.html" %}

{% block page_title %}List{% endblock %}

{% block head %}
    <script src="/static/sorttable.js"></script>
{% endblock %}

{% block content %}
    <p><strong>{{ search_criteria|capitalize }}</strong></p>

        <p>Displaying {{ name_list|length }} results from {{ offset + 1 }} to {{offset + display_count }} out of {{ '%d' % total_count }}.</p>

        <div class="well well-sm">
            <form class="pull-left" style="padding-right: 10px;" method="POST" action="/import">
                <input type="hidden" name="input_dataset" value="{% if selected_datasets|length == 1 %}{{selected_datasets[0]}}{%else%}{{search_criteria|capitalize}}{%endif%}" />
                <textarea style="display: none" name="scnames">{{ name_list|join("\n") }}</textarea>
                <input class="btn btn-primary" type="submit" value="Edit {{ name_list|count }} currently displayed names" />
            </form>

            <form method="POST" action="/import">
                <input type="hidden" name="input_dataset" value="{% if selected_datasets|length == 1 %}{{selected_datasets[0]}}{%else%}{{search_criteria|capitalize}}{%endif%}" />
                <textarea style="display: none" name="scnames">{{ genera_list|join("\n") }}</textarea>
                <input class="btn btn-primary" type="submit" value="Edit {{ genera_list|count }} currently displayed genera" />
            </form>
        </div>

        <form method="GET">
            <input type="hidden" name="offset" value="{{offset}}">
            <input type="hidden" name="display" value="{{display_count}}">

    <div id="list_content" style="width: 100%; margins: auto; text-align: center">
    <p>
        <button class="btn btn-default btn-xs" type="submit" name="offset" value="0"
            {% if offset == 0 %}disabled="disabled"{% endif %}
        ><span class="glyphicon glyphicon-step-backward" aria-hidden="true"></span></button>

        <button class="btn btn-default btn-xs" type="submit" name="offset" value="{{offset - display_count}}"
            {% if offset - display_count < 0 %}disabled="disabled"{% endif %}
        ><span class="glyphicon glyphicon-backward" aria-hidden="true"></span></button>

        |
        <select name="display" onchange="this.form.submit()">
            <option {% if display_count == 20 %}selected=1{% endif %}  value="20">Display 20 rows at once</option>
            <option {% if display_count == 40 %}selected=1{% endif %}  value="40">Display 40 rows at once</option>
            <option {% if display_count == 60 %}selected=1{% endif %}  value="60">Display 60 rows at once</option>
            <option {% if display_count == 80 %}selected=1{% endif %}  value="80">Display 80 rows at once</option>
            <option {% if display_count == 100 %}selected=1{% endif %}  value="100">Display 100 rows at once</option>
            <option {% if display_count == 200 %}selected=1{% endif %}  value="200">Display 200 rows at once</option>
            <option {% if display_count == 500 %}selected=1{% endif %}  value="500">Display 500 rows at once</option>
            <option {% if display_count == 1000 %}selected=1{% endif %}  value="1000">Display 1000 rows at once</option>
            <option {% if display_count == 2000 %}selected=1{% endif %}  value="2000">Display 2000 rows at once</option>
            <option {% if display_count == 5000 %}selected=1{% endif %}  value="5000">Display 5000 rows at once</option>
            <option {% if display_count == 10000 %}selected=1{% endif %}  value="10000">Display 10000 rows at once</option>
        </select>
        |

        <button class="btn btn-default btn-xs" type="submit" name="offset" value="{{offset + display_count}}"
            {% if total_count != 0 and offset + display_count >= total_count %}disabled="disabled"{% endif %}
        ><span class="glyphicon glyphicon-forward" aria-hidden="true"></span></button>

        <button class="btn btn-default btn-xs" type="submit" name="offset" value="{{total_count - display_count}}"
            {% if total_count == 0 or offset >= total_count - display_count %}disabled="disabled"{% endif %}
        ><span class="glyphicon glyphicon-step-forward" aria-hidden="true"></span></button>

        <br />
        <div class="well well-sm checkbox_group">
            Datasets (<button class="btn btn-danger btn-xs" type="submit" name="dataset" value="all">Clear</button>):
            <br />

            {% for dataset in datasets_data %}
                <label>
                <input type="checkbox" name="dataset" onclick="this.form.submit()"  value="{{ dataset['dataset'] }}"
                    {% if 'all' in selected_datasets %}
                    {% elif dataset['dataset'] in selected_datasets %}
                        checked=1
                    {% endif %}
                >{{dataset['dataset']}} ({{dataset['count']}} species)</input>
                </label>
            {% endfor %}
        </div>
        <br />
        <div class="well well-sm checkbox_group">
            Find blanks in (<button class="btn btn-danger btn-xs" type="submit" name="blank_lang" value="none">Clear</button>):
            <br />

            {% for lang in language_names_list %}
                <label>
                <input type="checkbox" name="blank_lang" onclick="this.form.submit()" value="{{lang}}"
                    {% if 'none' in selected_blank_langs %}
                    {% elif lang in selected_blank_langs %}
                        checked=1
                    {% endif %}
                >{{language_names[lang]}}</input>
                </label>
            {% endfor %}
        </div>
    </p>

    <p>(Genus common names are italicized)</p>

    <table class="sortable" border="1" width="100%">
        <thead><tr>
            <th>&nbsp;</th>
            <th>Species</th>
            <th>Family</th>
            <th>Genus</th>
            {% for name in language_names_list %}
                <th>{{ language_names[name] }}</th>
            {% endfor %}
        </tr></thead><tbody>
        {% if name_list|length == 0 %}
            <tr>
                <td colspan="{{ language_names_list|length + 3}}"><center><em>No results</em></center></td>
            </tr>
        {% else %}
            {% for name in name_list %}
                <tr>
                    <td>{{ loop.index + offset }}</td>
                    <td><em><a href="/?lookup={{name}}&search={{name}}">{{ name | capitalize }}</a></em></td>
                    <!--
                    <td style="font-size: 8pt"><tt>http://names.mol-api.appspot.com/?lookup={{name|replace(' ', '+')}}&amp;search={{name|replace(' ', '+')}}</tt></td>
                    <td>{{vnames[name]['tax_class']|join(", ") }}&nbsp;</td>
                    <td>{{vnames[name]['tax_order']|join(", ") }}&nbsp;</td>
                    -->
                    <td><a href="/?lookup={{vnames[name]['tax_family']|join(', ')}}">{{vnames[name]['tax_family']|join(", ")|capitalize }}</a>&nbsp;</td>
                    {% set genus = name.split()[0] %}
                    <td><em><a href="/?lookup={{genus}}">{{genus | capitalize}}</a></em></td>
                    {% for lang in language_names_list %}
                        {% if lang in vnames[name] and vnames[name][lang].vernacularname != '' %}
                            <td>
                            {% if vnames[name][lang].flag_uninomial %}<em>{% endif %}
                            <a href="/?lookup={{name}}&search={{name}}#lang-{{lang}}">{{ vnames[name][lang].vernacularname }}</a>
                            {% if vnames[name][lang].flag_uninomial %}</em>{% endif %}
                            </td>
                        {% else %}
                            <td>&nbsp;<!-- <a href="/?lookup={{name}}&search={{name}}#lang-{{lang}}"><center><em>None</em></center></a> --></td>
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}
        {% endif %}
    </tbody>
    </table>
    </div>

{% endblock %}
